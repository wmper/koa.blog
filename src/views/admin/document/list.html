<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>文档管理</title>
        <link rel="stylesheet" href="/css/common.css" />
        <link rel="stylesheet" href="/css/element.css" />
        <script src="/js/vue.js"></script>
        <script src="/js/element.js"></script>
        <script src="/js/axios.min.js"></script>
    </head>
    <body>
        <div id="app">
            <template>
                <div style="margin-bottom: 15px">
                    <el-button type="primary" plain size="small" @click="handleClick()">新增</el-button>
                    <el-button size="small" icon="el-icon-refresh-left" @click="load(0)">刷新</el-button>
                </div>
                <el-table :data="tableData" stripe style="width: 100%; font-size: 13px">
                    <el-table-column type="index" label="序号" width="80"> </el-table-column>
                    <el-table-column prop="category_name" label="分类" width="180"></el-table-column>
                    <el-table-column prop="title" label="标题"></el-table-column>
                    <el-table-column prop="create_time" label="日期" width="180"></el-table-column>
                    <el-table-column fixed="right" label="操作" width="180">
                        <template slot-scope="scope">
                            <el-button @click="handleClick(scope.row)" type="text" size="small">编辑</el-button>
                            <el-button @click="handleDelete(scope.row.id,scope.$index)" type="text" size="small" style="color: #ff0000">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>
                <div style="display: flex; flex-direction: row-reverse; margin-top: 30px">
                    <el-pagination @current-change="handleCurrentChange" :current-page.sync="current" :page-size="size" :total="total" background layout="total,prev, pager, next, jumper"> </el-pagination>
                </div>
            </template>
        </div>
        <script>
            axios.defaults.headers.common['Authorization'] = 'Bearer ' + window.localStorage.getItem('token')
            new Vue({
                el: '#app',
                data: {
                    current: 1,
                    size: 20,
                    total: 0,
                    tableData: []
                },
                methods: {
                    load(type) {
                        let _this = this
                        if (type == 0) _this.current = 1

                        axios.post('/api/document/list', { pageIndex: _this.current, pageSize: _this.size }).then((res) => {
                            if (res.status == 200) {
                                _this.tableData = res.data.data.list
                                _this.total = res.data.data.total

                                if (type == 0) _this.$message.success('刷新成功')
                            }
                        })
                    },
                    handleDelete(id, index) {
                        let _this = this

                        this.$confirm('确认删除?', '提示', {
                            type: 'warning'
                        }).then(() => {
                            axios.delete('/api/document/' + id).then((res) => {
                                if (res.data.code == 0) {
                                    _this.$message.success('删除成功')
                                    _this.tableData.splice(index, 1)
                                }
                            })
                        })
                    },
                    handleCurrentChange(val) {
                        this.current = val
                        this.load()
                    },
                    handleClick(e) {
                        let id = 0
                        if (e) id = e.id

                        location.href = '/admin/document/' + id
                    }
                },
                mounted() {
                    this.load()
                }
            })
        </script>
    </body>
</html>
